<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <title>Interaktiver Fragebogen - Dark Mode</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <!-- Google Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Roboto&display=swap" rel="stylesheet">
  <!-- Firebase SDKs -->
  <script src="https://www.gstatic.com/firebasejs/9.19.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.19.1/firebase-firestore.js"></script>
  <style>
    body {
      font-family: 'Roboto', sans-serif;
      background: #121212;
      margin: 0;
      padding: 0;
      color: #e0e0e0;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
    }
    #chat-container {
      width: 500px;
      max-width: 90%;
      background: #1e1e1e;
      border: 1px solid #333;
      border-radius: 8px;
      overflow: hidden;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.7);
      display: flex;
      flex-direction: column;
    }
    #chat {
      flex: 1;
      padding: 30px;
      overflow-y: auto;
      border-bottom: 1px solid #333;
    }
    .message {
      margin-bottom: 20px;
      opacity: 1;
    }
    .bot {
      font-size: 1.5em;
      font-weight: bold;
      line-height: 1.4;
      color: #ffffff;
    }
    .user {
      text-align: right;
      color: #4fc3f7;
      font-size: 1.2em;
    }
    #input-area {
      display: flex;
      padding: 20px;
      background: #181818;
    }
    #input-area input {
      flex: 1;
      padding: 12px;
      border: 1px solid #333;
      border-radius: 4px;
      font-size: 1em;
      background: #262626;
      color: #e0e0e0;
    }
    #input-area button {
      padding: 12px 20px;
      margin-left: 10px;
      border: none;
      background: #4fc3f7;
      color: #121212;
      border-radius: 4px;
      font-size: 1em;
      cursor: pointer;
      transition: background 0.3s ease;
    }
    #input-area button:hover {
      background: #38b0e3;
    }
  </style>
</head>
<body>
  <div id="chat-container">
    <div id="chat"></div>
    <div id="input-area">
      <input type="text" id="user-input" placeholder="Deine Antwort ..." />
      <button id="send-btn">Senden</button>
    </div>
  </div>

  <script>
    // Firebase initialisieren
    const firebaseConfig = {
      apiKey: "DEINE_API_KEY",
      authDomain: "DEIN-PROJEKT.firebaseapp.com",
      projectId: "DEIN-PROJEKT",
      storageBucket: "DEIN-PROJEKT.appspot.com",
      messagingSenderId: "DEINE_SENDER_ID",
      appId: "DEINE_APP_ID"
    };
    const appFirebase = firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore(appFirebase);

    // Fragen-Array
    const questions = [
      "Was ist das Ziel deines Suchens?",
      "Wann möchtest du das Ganze beginnen und wie lange soll es gehen?",
      "Was ist der Status Quo bzw. was ist der Wissensstand deines Vorhabens oder deiner Projektteilnehmer?"
    ];
    let currentQuestionIndex = 0;
    let sessionData = {
      timestamp: new Date().toISOString(),
      responses: {}
    };

    const chatDiv = document.getElementById("chat");
    const inputField = document.getElementById("user-input");
    const sendBtn = document.getElementById("send-btn");

    // Typewriter-Funktion: zeigt Text buchstabeweise an
    function typeText(target, text, callback) {
      let index = 0;
      target.innerText = "";
      let timer = setInterval(() => {
        target.innerText += text[index];
        index++;
        if(index === text.length) {
          clearInterval(timer);
          if(callback) callback();
        }
      }, 50); // 50 Millisekunden pro Buchstabe
    }

    // Zeigt die nächste Frage mit Typewriter-Effekt
    function showNextQuestion() {
      if (currentQuestionIndex < questions.length) {
        const msgDiv = document.createElement("div");
        msgDiv.classList.add("message", "bot");
        chatDiv.appendChild(msgDiv);
        typeText(msgDiv, questions[currentQuestionIndex], () => {
          chatDiv.scrollTop = chatDiv.scrollHeight;
        });
      } else {
        addMessage("Vielen Dank! Deine Antworten wurden gespeichert.", "bot");
        saveSessionData(sessionData);
      }
    }

    // Fügt eine Nachricht ohne Animation hinzu (für Nutzer-Antworten)
    function addMessage(text, sender) {
      const msgDiv = document.createElement("div");
      msgDiv.classList.add("message", sender);
      msgDiv.innerText = text;
      chatDiv.appendChild(msgDiv);
      chatDiv.scrollTop = chatDiv.scrollHeight;
    }

    // Beim Start wird die erste Frage angezeigt
    showNextQuestion();

    // Verarbeitet Antworten des Nutzers
    function processAnswer() {
      const answer = inputField.value.trim();
      if(!answer) return;
      addMessage(answer, "user");

      // Speichere die Antwort
      switch(currentQuestionIndex) {
        case 0:
          sessionData.responses.ziel = answer;
          break;
        case 1:
          sessionData.responses.zeitplanung = answer;
          break;
        case 2:
          sessionData.responses.status_quo = answer;
          break;
      }
      inputField.value = "";
      currentQuestionIndex++;
      // Zeige die nächste Frage an (mit Typewriter-Effekt)
      setTimeout(showNextQuestion, 500);
    }

    function saveSessionData(data) {
      db.collection("sessions").add(data)
        .then((docRef) => {
          console.log("Session gespeichert mit ID:", docRef.id);
        })
        .catch((error) => {
          console.error("Fehler beim Speichern:", error);
        });
    }

    sendBtn.addEventListener("click", processAnswer);
    inputField.addEventListener("keypress", (e) => {
      if(e.key === "Enter") processAnswer();
    });
  </script>
</body>
</html>
